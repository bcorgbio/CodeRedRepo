---
title: "Code-Red_module6"
author: "Liz Aspirino, Tingwei Hu, James Kim, Justin Lau"
date: "2022-11-02"
output: html_document
bibliography: BIOL3140.bib
nocite: '@*'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, packages, include=FALSE}
library(tidyverse)
library(Momocs)
library(knitr)
library(vroom)
library(ape)
```
#Introduction
Leidoptera describes the order of insects that is compromised of over 160,000 species of butterflies and moths. The Leidoptera occupy various ecological niche in different geographical locations using their ability to fly to traverse their environment. Their wings can be separated into their fore wings and hind wings which plays a different role in the Leidoptera's ability to fly. Previous studies have found that if the hindwings were to be removed, the leidoptera is able to fly but their ability for linear and turning acceleration is greatly hindered (Jantzen and Eisner 2008). It can be then said that the wing shape of the various Leidoptera species is the result of environmental pressure that selected for shapes of the wings that allows for better flight maneuverability. This is supported by various studies that suggested that the selection of fore wing shape is determined by its ability to fly while the hind wing shape id determined by several possible neutral selections such as sexual selection to predator avoidance (Sourakov 2013, Barber et al. 2015, Willmott et al. 2017, Rubin et al. 2018, Chazot et al. 2016). However, it is not known whether then the evolution of hind wing and fore wings shape have occured independently or if a correlation could be found. The goal of this study is to determine the evolutionary correlation between the hind wing and fore wing shape by running a comparative phylogenetic analysis on the wing shape data of more than 200 Leidoptera species to determine if any significant relationship in evolutionary shift can be found.

#Methods

```{r, preprocessing, results='hide'}
#read files and make matrix
f <- list.files("class_out_data",pattern=".txt|.csv",full.names = TRUE)
out <- read_delim(f[1],delim="\t") %>% 
  as.matrix()
#transform matrix in momocs outline
out %>% 
  list() %>% 
  Out() %>% 
  coo_flipx() %>% 
  stack()
```

```{r, loading files & more preprocessing, results='hide'}
#make a large df with vroom
out.df <- vroom::vroom(f, id = "filename")
#add wing info
out.df <- out.df %>% 
  mutate(wing=gsub("XY_.+_(hindwing|forewing)\\..+","\\1",basename(filename))) %>% 
  na.omit()
#make list
outs.l <- sapply(f,function(x) out.df %>% filter(filename==x) %>% select(X,Y) %>% as.matrix)
#extract wing info
wings <- gsub("XY_.+_(hindwing|forewing)\\..+","\\1",basename(names(outs.l)))
outs <-  outs.l %>% 
  Out(fac=list(wing=wings)) %>% 
  coo_flipx() %>% 
  stack() #visualize both wings uncorreced for size
```

```{r, Separate and Procrustes transform both wings}
#separate outlines by fore&hind wing
forewings <- outs %>% 
  filter(wing=="forewing")

hindwings <- outs %>% 
  filter(wing=="hindwing")

#Procrustes, align
fore.min <- forewings %>% 
  coo_nb() %>% 
  min()
forewings %>%
  coo_interpolate(fore.min) %>% 
  fgProcrustes() %>% 
  stack() #visualize forewings
hind.min <- hindwings %>% 
  coo_nb() %>% 
  min()
hindwings %>% 
   coo_interpolate(hind.min) %>% 
  coo_slide(id=1) %>% 
   coo_align()  %>%
  fgProcrustes() %>%
  stack() #visualize hindwings
```
```{r,}

```

#Results

#Discussion

#Author Contributions

#References